(function(t){function e(e){for(var a,o,r=e[0],l=e[1],c=e[2],u=0,v=[];u<r.length;u++)o=r[u],Object.prototype.hasOwnProperty.call(i,o)&&i[o]&&v.push(i[o][0]),i[o]=0;for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(t[a]=l[a]);d&&d(e);while(v.length)v.shift()();return n.push.apply(n,c||[]),s()}function s(){for(var t,e=0;e<n.length;e++){for(var s=n[e],a=!0,r=1;r<s.length;r++){var l=s[r];0!==i[l]&&(a=!1)}a&&(n.splice(e--,1),t=o(o.s=s[0]))}return t}var a={},i={app:0},n=[];function o(e){if(a[e])return a[e].exports;var s=a[e]={i:e,l:!1,exports:{}};return t[e].call(s.exports,s,s.exports,o),s.l=!0,s.exports}o.m=t,o.c=a,o.d=function(t,e,s){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(o.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)o.d(s,a,function(e){return t[e]}.bind(null,a));return s},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],l=r.push.bind(r);r.push=e,r=r.slice();for(var c=0;c<r.length;c++)e(r[c]);var d=l;n.push([0,"chunk-vendors"]),s()})({0:function(t,e,s){t.exports=s("56d7")},"034f":function(t,e,s){"use strict";var a=s("85ec"),i=s.n(a);i.a},"11fa":function(t,e,s){"use strict";var a=s("6d28"),i=s.n(a);i.a},"3dfd":function(t,e,s){"use strict";s.d(e,"a",(function(){return u}));var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"row",attrs:{id:"app"}},[s("div",{staticClass:"col-12"},[s("nav",{staticClass:"navbar navbar-expand-sm navbar-light bg-light",attrs:{id:"nav"}},[s("router-link",{staticClass:"navbar-brand",attrs:{to:"/"}},[t._v("ДТО WEB-сервер")]),t._m(0),s("div",{staticClass:"collapse navbar-collapse",attrs:{id:"mainNavBar"}},[s("div",{staticClass:"navbar-nav"},[s("router-link",{staticClass:"nav-item nav-link",attrs:{to:"/devices"}},[t._v("Устройства")]),s("router-link",{staticClass:"nav-item nav-link",attrs:{to:"/settings"}},[t._v("Настройки web-сервера")])],1)])],1)]),s("div",{staticClass:"col-12"},[s("router-view",{on:{"update-store":t.updateStore,newMessage:t.addToast}})],1),t._m(1),s("div",{staticClass:"col-12 pt-5"},[s("div",{staticClass:"navbar navbar-light bg-light"},[s("span",{staticClass:"text-muted"},[t._v(t._s(t.getFieldDescription("serverVersion"))+": "),s("b",[t._v(t._s(t.server_version))])]),s("span",{staticClass:"text-muted"},[t._v(t._s(t.getFieldDescription("driverVersion"))+": "),s("b",[t._v(t._s(t.driver_version))])])])])])},i=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("button",{staticClass:"navbar-toggler",attrs:{type:"button","data-toggle":"collapse","data-target":"#mainNavBar","aria-controls":"mainNavBar","aria-expanded":"false","aria-label":"Toggle navigation"}},[s("span",{staticClass:"navbar-toggler-icon"})])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"toaster-container","aria-live":"polite","aria-atomic":"true"}},[s("div",{staticStyle:{position:"fixed",top:"10px",right:"10px",width:"250px"},attrs:{id:"toaster"}})])}],n=(s("a4d3"),s("e01a"),s("b0c0"),s("d3b7"),s("ac1f"),s("5319"),s("4989"),s("bc3a")),o=s.n(n),r=s("a18c"),l=s("1157"),c=s.n(l),d="/api/v2/",u=o.a.create({baseURL:d});u.interceptors.request.use((function(t){var e=JSON.parse(sessionStorage.getItem("access")),s=sessionStorage.getItem("user_name"),a=sessionStorage.getItem("user_password");function i(t){return btoa(encodeURIComponent(t).replace(/%([0-9A-F]{2})/g,(function(t,e){return String.fromCharCode("0x"+e)})))}return e?t.headers.Authorization="Basic "+i(s+":"+a):delete t.headers.Authorization,t})),u.interceptors.response.use((function(t){return t}),(function(t){var e=r["a"].currentRoute;if(t.response||"notavailable"!==e.name&&r["a"].push({name:"notavailable",params:{target_name:e.path,server_available:!1}}).catch((function(){})),t.response&&401===t.response.status){var s=sessionStorage.getItem("fails_count");sessionStorage.setItem("fails_count",null===s?1:parseInt(s)+1),sessionStorage.setItem("access",!1),"authorization"!==e.name&&r["a"].push({name:"authorization",params:{target_name:e.path,need_authorization:!0}}).catch((function(){}))}return Promise.reject(t)}));var v=0,g={serverVersion:{type:"string",description:"Версия WEB-сервера"},driverVersion:{type:"string",description:"Версия подключенного драйвера"},os:{type:"string",description:"Тип ОС, на которой запущен WEB-сервер",enum:["linux","windows","macos"]}},p={name:"App",data:function(){return{user_name:null,driver_version:"",server_version:"",descriptions:g,os:""}},watch:{$route:function(){this.user_name=sessionStorage.getItem("user_name")}},created:function(){this.user_name=sessionStorage.getItem("user_name")},mounted:function(){this.updateStore()},methods:{hasAuth:function(){return JSON.parse(sessionStorage.getItem("access"))},getFieldDescription:function(t){return this.descriptions.hasOwnProperty(t)?this.descriptions[t].description:"Отсутствует описание поля"},addToast:function(t,e,s,a,i,n){void 0===i&&(i=6e3),void 0===t&&(t="Заголовок отсутствует"),void 0===e&&(e="Сообщение отсутствует"),n=void 0===n?"":'<span class="oi oi-'+n+' mr-2">';var o=s+"_"+v,r=c()('<div id="'+o+'" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-delay="'+i+'">    <div class="toast-header">        '+n+'</span><strong class="mr-auto">'+t+'</strong>    </div>    <div class="toast-body">'+e+"</div></div>"),l=c()('[id^="'+s+'_"]');v+=1,a&&l.length?l.replaceWith(r):c()("#toaster").append(r),r.toast("show"),r.on("hidden.bs.toast",(function(t){c()(t.target).remove()})),r.on("click",(function(t){c()(t.currentTarget).remove()}))},updateStore:function(){this.getVersions(),this.getMapping()},getVersions:function(){var t=this;u.get("serverInfo").then((function(e){var s=e.data;t.driver_version=s["driverVersion"],t.server_version=s["serverVersion"],t.os=s["os"],t.$store.commit("SET_OS",s["os"])}))},getMapping:function(){var t=this;u.get("utils/mapping").then((function(e){t.$store.commit("MAPPING",e.data)}))}}},m=p,h=(s("034f"),s("2877")),f=Object(h["a"])(m,a,i,!1,null,null,null);e["b"]=f.exports},4360:function(t,e,s){"use strict";var a=s("2b0e"),i=s("2f62");a["a"].use(i["a"]),e["a"]=new i["a"].Store({state:{os:null,mapping:[]},mutations:{SET_OS:function(t,e){t.os=e},MAPPING:function(t,e){t.mapping=e}},getters:{OS:function(t){return t.os},MAPPING:function(t){return t.mapping}},actions:{},modules:{}})},"53af":function(t,e,s){t.exports=s.p+"img/add_device_modal.80da6c4c.png"},"56d7":function(t,e,s){"use strict";s.r(e),function(t){s("e260"),s("e6cf"),s("cca6"),s("a79d");var e=s("2b0e"),a=s("3dfd"),i=s("4360"),n=s("a18c"),o=s("ecee"),r=s("c074"),l=s("ad3d"),c=s("00e7"),d=s.n(c);o["c"].add(r["h"]),o["c"].add(r["g"]),o["c"].add(r["a"]),o["c"].add(r["c"]),o["c"].add(r["d"]),o["c"].add(r["f"]),o["c"].add(r["e"]),o["c"].add(r["b"]),e["a"].component("font-awesome-icon",l["a"]),t.jQuery=s("1157"),e["a"].use(d.a),e["a"].config.productionTip=!1,new e["a"]({store:i["a"],router:n["a"],render:function(t){return t(a["b"])}}).$mount("#app")}.call(this,s("c8ba"))},"6d28":function(t,e,s){},"85ec":function(t,e,s){},a18c:function(t,e,s){"use strict";var a=s("2b0e"),i=s("8c4f"),n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"row"},[200===t.status_code||null!==t.data?s("div",{staticClass:"col-12 pt-3"},[s("div",{staticClass:"row"},[s("div",{staticClass:"col-12"},[s("h4",[t._v("Устройство "),s("span",{staticClass:"badge badge-success"},[t._v(t._s(t.id))])])])]),s("div",{staticClass:"row"},[s("div",{staticClass:"col-12"},[t._m(0),s("div",{staticClass:"tab-content",attrs:{id:"settings-content"}},[s("div",{staticClass:"tab-pane fade show active",attrs:{id:"requests-queue-statuses",role:"tabpanel","aria-labelledby":"requests-queue-statuses-tab"}},[s("div",{staticClass:"row pt-3"},[s("div",{staticClass:"col-12"},[s("div",{staticClass:"card mb-3",class:t.getClass(this)},[s("div",{staticClass:"card-header"},[t._v("Cостояние очереди заданий")]),s("div",{staticClass:"card-body text-primary"},[null!==t.requests_queue_status_code&&200!==t.requests_queue_status_code?s("h5",{staticClass:"card-title"},[t._v(t._s(t.getText()))]):t._e(),null!==t.requests_queue_status_code&&200!==t.requests_queue_status_code?s("div",{staticClass:"alert alert-danger",attrs:{role:"alert"}},[s("span",{staticClass:"badge badge-danger"},[t._v(t._s(t.requestsQueueStatusData.error.code))]),t._v(" "+t._s(t.requestsQueueStatusData.error.description)+" ")]):s("div",[s("table",{staticClass:"table table-borderless table-responsive"},[s("tbody",t._l(t.requestsQueueStatusData,(function(e,a){return s("tr",{key:a},[s("td",{staticClass:"text-right",staticStyle:{"max-width":"50%"}},[t._v(" "+t._s(t.getSettingsDescription("requestsQueueStatus",a))+" ")]),s("td",{staticStyle:{"min-width":"50%"},domProps:{innerHTML:t._s(t.getRequestQueueValueView(a,e))}})])})),0)])])])])])])]),s("div",{staticClass:"tab-pane fade",attrs:{id:"settings",role:"tabpanel","aria-labelledby":"connection-settings-tab"}},[s("ul",{staticClass:"nav nav-pills pt-3",attrs:{id:"",role:"tablist"}},[s("li",{staticClass:"nav-item"},[s("a",{staticClass:"nav-link active",attrs:{id:"connection-settings-tab","data-toggle":"tab",href:"#connection-settings",role:"tab","aria-controls":"requests-queue-statuses","aria-selected":"true"}},[s("font-awesome-icon",{attrs:{icon:"satellite-dish"}}),t._v(" Настройки связи с ККТ ")],1)]),s("li",{staticClass:"nav-item"},[s("a",{staticClass:"nav-link",attrs:{id:"other-setting-tab","data-toggle":"tab",href:"#other-setting",role:"tab","aria-controls":"other-setting","aria-selected":"false"}},[s("font-awesome-icon",{attrs:{icon:"screwdriver"}}),t._v(" Прочие настройки ККТ ")],1)])]),s("div",{staticClass:"tab-content",attrs:{id:"tab-content"}},[s("div",{staticClass:"tab-pane fade show active",attrs:{id:"connection-settings",role:"tabpanel","aria-labelledby":""}},[s("div",{staticClass:"mt-3"},[s("form",{staticClass:"needs-validation",attrs:{id:"connectionSettings",novalidate:""}},[s("div",{staticClass:"form-row"},[s("div",{staticClass:"form-group col-md-12"},[s("label",{attrs:{for:"model"}},[t._v(" Модель ")]),s("select",{directives:[{name:"model",rawName:"v-model.number",value:t.data.connectionSettings.model,expression:"data.connectionSettings.model",modifiers:{number:!0}}],staticClass:"custom-select",attrs:{id:"model",name:"model"},on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(e){var s="_value"in e?e._value:e.value;return t._n(s)}));t.$set(t.data.connectionSettings,"model",e.target.multiple?s:s[0])}}},t._l(t.mapping_model,(function(e,a){return s("option",{key:a,domProps:{value:t.mapping_model[a]["key"]}},[t._v(" "+t._s(t.mapping_model[a]["description"])+" ")])})),0)])]),s("div",{staticClass:"form-row"},[s("div",{staticClass:"form-group col-sm-12 col-md-6"},[s("label",{attrs:{for:"userPassword"}},[t._v(" "+t._s(t.getSettingsDescription("connectionSettings","userPassword"))+" ")]),s("input",{directives:[{name:"model",rawName:"v-model",value:t.data.connectionSettings.userPassword,expression:"data.connectionSettings.userPassword"}],staticClass:"form-control",attrs:{type:"text",id:"userPassword",name:"userPassword",pattern:"^.{0,16}$"},domProps:{value:t.data.connectionSettings.userPassword},on:{input:function(e){e.target.composing||t.$set(t.data.connectionSettings,"userPassword",e.target.value)}}}),s("div",{staticClass:"invalid-feedback"},[t._v("Максимальная длина пароля пользователя по умолчанию не должна превышать 16 символов ")])]),s("div",{staticClass:"form-group col-sm-12 col-md-6"},[s("label",{attrs:{for:"accessPassword"}},[t._v(" "+t._s(t.getSettingsDescription("connectionSettings","accessPassword"))+" ")]),s("input",{directives:[{name:"model",rawName:"v-model",value:t.data.connectionSettings.accessPassword,expression:"data.connectionSettings.accessPassword"}],staticClass:"form-control",attrs:{type:"text",id:"accessPassword",name:"accessPassword",pattern:"^.{0,16}$"},domProps:{value:t.data.connectionSettings.accessPassword},on:{input:function(e){e.target.composing||t.$set(t.data.connectionSettings,"accessPassword",e.target.value)}}}),s("div",{staticClass:"invalid-feedback"},[t._v("Максимальная длина пароля доступа не должна превышать 16 символов ")])])]),s("div",{staticClass:"form-row"},[s("div",{staticClass:"form-group col-sm-12 col-md-6 col-xl-4"},[s("label",{attrs:{for:"port"}},[t._v(" "+t._s(t.getSettingsDescription("connectionSettings","port"))+" ")]),s("select",{directives:[{name:"model",rawName:"v-model",value:t.data.connectionSettings.port,expression:"data.connectionSettings.port"}],staticClass:"custom-select",attrs:{id:"port",name:"port"},on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(t.data.connectionSettings,"port",e.target.multiple?s:s[0])}}},t._l(t.mapping_port,(function(e,a){return s("option",{key:a,domProps:{value:t.mapping_port[a]["key"]}},[t._v(" "+t._s(t.mapping_port[a]["description"])+" ")])})),0)]),"windows"===t.os?s("div",{staticClass:"form-group col-sm-12 col-md-6 col-xl-4"},[s("label",{attrs:{for:"com"}},[t._v(" "+t._s(t.getSettingsDescription("connectionSettings","com"))+" ")]),s("select",{directives:[{name:"model",rawName:"v-model",value:t.data.connectionSettings.com,expression:"data.connectionSettings.com"}],staticClass:"custom-select",style:"0"===t.data.connectionSettings.com?"color: #b5b5b5;":"",attrs:{id:"com",name:"com"},on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(t.data.connectionSettings,"com",e.target.multiple?s:s[0])}}},[t._l(t.mapping_com,(function(e,a){return s("option",{key:a,style:"0"!==a?"color: black;":"",domProps:{value:t.mapping_com[a]["key"]}},[t._v(" "+t._s(t.mapping_com[a]["description"])+" ")])})),s("option",{attrs:{value:"0",disabled:"",selected:"",hidden:""}},[t._v(t._s(t.getPlaceholder("com"))+" ")])],2)]):s("div",{staticClass:"form-group col-sm-12 col-md-6 col-xl-4"},[s("label",{attrs:{for:"com"}},[t._v(" "+t._s(t.getSettingsDescription("connectionSettings","com"))+" ")]),s("input",{directives:[{name:"model",rawName:"v-model",value:t.com_intermediary,expression:"com_intermediary"}],staticClass:"custom-select",attrs:{id:"com",name:"com",list:"coms",placeholder:t.getPlaceholder("com")},domProps:{value:t.com_intermediary},on:{input:function(e){e.target.composing||(t.com_intermediary=e.target.value)}}}),s("datalist",{attrs:{id:"coms"}},t._l(t.mapping_com,(function(e,a){return s("option",{key:a,domProps:{value:t.mapping_com[a]["description"]}})})),0)]),s("div",{staticClass:"form-group col-sm-12 col-md-12 col-xl-4"},[s("label",{attrs:{for:"baudRate"}},[t._v(" "+t._s(t.getSettingsDescription("connectionSettings","baudRate"))+" ")]),s("select",{directives:[{name:"model",rawName:"v-model.number",value:t.data.connectionSettings.baudRate,expression:"data.connectionSettings.baudRate",modifiers:{number:!0}}],staticClass:"custom-select",attrs:{id:"baudRate",name:"baudRate"},on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(e){var s="_value"in e?e._value:e.value;return t._n(s)}));t.$set(t.data.connectionSettings,"baudRate",e.target.multiple?s:s[0])}}},t._l(t.mapping_baud_rate,(function(e,a){return s("option",{key:a,domProps:{value:t.mapping_baud_rate[a]["key"]}},[t._v(" "+t._s(t.mapping_baud_rate[a]["description"])+" ")])})),0)])]),s("div",{staticClass:"form-row"},[s("div",{class:t.ipAddressClass},[s("label",{attrs:{for:"ipAddress"}},[t._v(" "+t._s(t.getSettingsDescription("connectionSettings","ipAddress"))+" ")]),s("input",{directives:[{name:"model",rawName:"v-model",value:t.data.connectionSettings.ipAddress,expression:"data.connectionSettings.ipAddress"}],staticClass:"form-control",attrs:{type:"text",id:"ipAddress",name:"ipAddress"},domProps:{value:t.data.connectionSettings.ipAddress},on:{input:function(e){e.target.composing||t.$set(t.data.connectionSettings,"ipAddress",e.target.value)}}})]),s("div",{staticClass:"form-group col-sm-4 col-md-2 col-lg-2"},[s("label",{attrs:{for:"ipPort"}},[t._v(" "+t._s(t.getSettingsDescription("connectionSettings","ipPort"))+" ")]),s("input",{directives:[{name:"model",rawName:"v-model.number",value:t.data.connectionSettings.ipPort,expression:"data.connectionSettings.ipPort",modifiers:{number:!0}}],staticClass:"form-control",attrs:{type:"number",id:"ipPort",name:"ipPort",min:t.descriptions.connectionSettings.ipPort.minimum,max:t.descriptions.connectionSettings.ipPort.maximum,pattern:"^([1-9]|[1-5]?[0-9]{2,4}|6[1-4][0-9]{3}|65[1-4][0-9]{2}|655[1-2][0-9]|6553[1-5])$",required:""},domProps:{value:t.data.connectionSettings.ipPort},on:{input:function(e){e.target.composing||t.$set(t.data.connectionSettings,"ipPort",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}})]),s("div",{staticClass:"form-group col-md-4 col-lg-3"},[s("label",{attrs:{for:"mac"}},[t._v(" "+t._s(t.getSettingsDescription("connectionSettings","mac"))+" ")]),s("masked-input",{staticClass:"form-control",attrs:{pattern:"^([0-9A-Fa-f]{2}[:-]){5}([0-9A-Fa-f]{2})$",type:"text",name:"mac",id:"mac",mask:[/[0-9A-Fa-f]/,/[0-9A-Fa-f]/,":",/[0-9A-Fa-f]/,/[0-9A-Fa-f]/,":",/[0-9A-Fa-f]/,/[0-9A-Fa-f]/,":",/[0-9A-Fa-f]/,/[0-9A-Fa-f]/,":",/[0-9A-Fa-f]/,/[0-9A-Fa-f]/,":",/[0-9A-Fa-f]/,/[0-9A-Fa-f]/],guide:!0,placeholderChar:"_"},model:{value:t.data.connectionSettings.mac,callback:function(e){t.$set(t.data.connectionSettings,"mac",e)},expression:"data.connectionSettings.mac"}})],1),"windows"!==t.os?s("div",{staticClass:"form-group col-sm-12 col-md-12 col-xl-4 col-lg-4"},[s("label",{attrs:{for:"usbDevice"}},[t._v(" "+t._s(t.getSettingsDescription("connectionSettings","usbDevice"))+" ")]),s("select",{directives:[{name:"model",rawName:"v-model",value:t.data.connectionSettings.usbDevice,expression:"data.connectionSettings.usbDevice"}],staticClass:"custom-select",attrs:{id:"usbDevice",name:"usbDevice"},on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(t.data.connectionSettings,"usbDevice",e.target.multiple?s:s[0])}}},t._l(t.mapping_usb_device,(function(e,a){return s("option",{key:a,domProps:{value:t.mapping_usb_device[a]["key"]}},[t._v(" "+t._s(t.mapping_usb_device[a]["description"])+" ")])})),0)]):t._e(),s("div",{staticClass:"form-group col-12"},[s("label",{attrs:{for:"ofdChannel"}},[t._v(" "+t._s(t.getSettingsDescription("connectionSettings","ofdChannel"))+" ")]),s("select",{directives:[{name:"model",rawName:"v-model.number",value:t.data.connectionSettings.ofdChannel,expression:"data.connectionSettings.ofdChannel",modifiers:{number:!0}}],staticClass:"custom-select",attrs:{id:"ofdChannel",name:"ofdChannel"},on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(e){var s="_value"in e?e._value:e.value;return t._n(s)}));t.$set(t.data.connectionSettings,"ofdChannel",e.target.multiple?s:s[0])}}},t._l(t.mapping_ofd_channel,(function(e,a){return s("option",{key:a,domProps:{value:t.mapping_ofd_channel[a]["key"]}},[t._v(" "+t._s(t.mapping_ofd_channel[a]["description"])+" ")])})),0)])])])])]),s("div",{staticClass:"tab-pane fade",attrs:{id:"other-setting",role:"tabpanel","aria-labelledby":""}},[s("div",{staticClass:"mt-3"},[s("form",{staticClass:"needs-validation",attrs:{id:"otherSettings",novalidate:""}},[s("div",{staticClass:"form-group"},[s("label",{attrs:{for:"name"}},[t._v(" Название ККТ ")]),s("input",{directives:[{name:"model",rawName:"v-model",value:t.data.name,expression:"data.name"}],staticClass:"form-control",attrs:{type:"text",id:"name",name:"name",placeholder:t.getPlaceholder("name"),pattern:"^.{0,128}$"},domProps:{value:t.data.name},on:{input:function(e){e.target.composing||t.$set(t.data,"name",e.target.value)}}}),s("div",{staticClass:"invalid-feedback"},[t._v("Максимальная длина имени устройства не должна превышать 128 символов ")])]),s("div",{staticClass:"form-group"},[s("div",{staticClass:"custom-control custom-switch"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.data.otherSettings.useGlobalScriptsSettings,expression:"data.otherSettings.useGlobalScriptsSettings"}],staticClass:"custom-control-input",attrs:{type:"checkbox",id:"useGlobalScriptsSettings",name:"useGlobalScriptsSettings"},domProps:{checked:Array.isArray(t.data.otherSettings.useGlobalScriptsSettings)?t._i(t.data.otherSettings.useGlobalScriptsSettings,null)>-1:t.data.otherSettings.useGlobalScriptsSettings},on:{change:function(e){var s=t.data.otherSettings.useGlobalScriptsSettings,a=e.target,i=!!a.checked;if(Array.isArray(s)){var n=null,o=t._i(s,n);a.checked?o<0&&t.$set(t.data.otherSettings,"useGlobalScriptsSettings",s.concat([n])):o>-1&&t.$set(t.data.otherSettings,"useGlobalScriptsSettings",s.slice(0,o).concat(s.slice(o+1)))}else t.$set(t.data.otherSettings,"useGlobalScriptsSettings",i)}}}),s("label",{staticClass:"custom-control-label",attrs:{for:"useGlobalScriptsSettings"}},[t._v(" "+t._s(t.getSettingsDescription("otherSettings","useGlobalScriptsSettings"))+" ")])])]),s("div",{staticClass:"form-group"},[s("label",{attrs:{for:"scriptsPath"}},[t._v(" "+t._s(t.getSettingsDescription("otherSettings","scriptsPath"))+" ")]),s("input",{directives:[{name:"model",rawName:"v-model",value:t.data.otherSettings.scriptsPath,expression:"data.otherSettings.scriptsPath"}],staticClass:"form-control",attrs:{type:"text",id:"scriptsPath",name:"scriptsPath",disabled:t.data.otherSettings.useGlobalScriptsSettings},domProps:{value:t.data.otherSettings.scriptsPath},on:{input:function(e){e.target.composing||t.$set(t.data.otherSettings,"scriptsPath",e.target.value)}}})]),s("div",{staticClass:"form-group"},[s("div",{staticClass:"custom-control custom-switch"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.data.otherSettings.useGlobalInvertCashDrawerStatusFlag,expression:"data.otherSettings.useGlobalInvertCashDrawerStatusFlag"}],staticClass:"custom-control-input",attrs:{type:"checkbox",id:"useGlobalInvertCashDrawerStatusFlag",name:"useGlobalInvertCashDrawerStatusFlag"},domProps:{checked:Array.isArray(t.data.otherSettings.useGlobalInvertCashDrawerStatusFlag)?t._i(t.data.otherSettings.useGlobalInvertCashDrawerStatusFlag,null)>-1:t.data.otherSettings.useGlobalInvertCashDrawerStatusFlag},on:{change:function(e){var s=t.data.otherSettings.useGlobalInvertCashDrawerStatusFlag,a=e.target,i=!!a.checked;if(Array.isArray(s)){var n=null,o=t._i(s,n);a.checked?o<0&&t.$set(t.data.otherSettings,"useGlobalInvertCashDrawerStatusFlag",s.concat([n])):o>-1&&t.$set(t.data.otherSettings,"useGlobalInvertCashDrawerStatusFlag",s.slice(0,o).concat(s.slice(o+1)))}else t.$set(t.data.otherSettings,"useGlobalInvertCashDrawerStatusFlag",i)}}}),s("label",{staticClass:"custom-control-label",attrs:{for:"useGlobalInvertCashDrawerStatusFlag"}},[t._v(" "+t._s(t.getSettingsDescription("otherSettings","useGlobalInvertCashDrawerStatusFlag"))+" ")])])]),s("div",{staticClass:"form-group"},[s("div",{staticClass:"custom-control custom-switch"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.data.otherSettings.invertCashDrawerStatus,expression:"data.otherSettings.invertCashDrawerStatus"}],staticClass:"custom-control-input",attrs:{type:"checkbox",id:"invertCashDrawerStatus",name:"invertCashDrawerStatus",disabled:t.data.otherSettings.useGlobalInvertCashDrawerStatusFlag},domProps:{checked:Array.isArray(t.data.otherSettings.invertCashDrawerStatus)?t._i(t.data.otherSettings.invertCashDrawerStatus,null)>-1:t.data.otherSettings.invertCashDrawerStatus},on:{change:function(e){var s=t.data.otherSettings.invertCashDrawerStatus,a=e.target,i=!!a.checked;if(Array.isArray(s)){var n=null,o=t._i(s,n);a.checked?o<0&&t.$set(t.data.otherSettings,"invertCashDrawerStatus",s.concat([n])):o>-1&&t.$set(t.data.otherSettings,"invertCashDrawerStatus",s.slice(0,o).concat(s.slice(o+1)))}else t.$set(t.data.otherSettings,"invertCashDrawerStatus",i)}}}),s("label",{staticClass:"custom-control-label",attrs:{for:"invertCashDrawerStatus"}},[t._v(" "+t._s(t.getSettingsDescription("otherSettings","invertCashDrawerStatus"))+" ")])])]),s("div",{staticClass:"form-group"},[s("div",{staticClass:"custom-control custom-switch"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.data.otherSettings.useGlobalAdditionalHeaderLines,expression:"data.otherSettings.useGlobalAdditionalHeaderLines"}],staticClass:"custom-control-input",attrs:{type:"checkbox",id:"useGlobalAdditionalHeaderLines",name:"useGlobalAdditionalHeaderLines"},domProps:{checked:Array.isArray(t.data.otherSettings.useGlobalAdditionalHeaderLines)?t._i(t.data.otherSettings.useGlobalAdditionalHeaderLines,null)>-1:t.data.otherSettings.useGlobalAdditionalHeaderLines},on:{change:function(e){var s=t.data.otherSettings.useGlobalAdditionalHeaderLines,a=e.target,i=!!a.checked;if(Array.isArray(s)){var n=null,o=t._i(s,n);a.checked?o<0&&t.$set(t.data.otherSettings,"useGlobalAdditionalHeaderLines",s.concat([n])):o>-1&&t.$set(t.data.otherSettings,"useGlobalAdditionalHeaderLines",s.slice(0,o).concat(s.slice(o+1)))}else t.$set(t.data.otherSettings,"useGlobalAdditionalHeaderLines",i)}}}),s("label",{staticClass:"custom-control-label",attrs:{for:"useGlobalAdditionalHeaderLines"}},[t._v(" "+t._s(t.getSettingsDescription("otherSettings","useGlobalAdditionalHeaderLines"))+" ")])])]),s("div",{staticClass:"form-group"},[s("label",{attrs:{for:"additionalHeaderLines"}},[t._v(" "+t._s(t.getSettingsDescription("otherSettings","additionalHeaderLines"))+" ")]),s("textarea",{directives:[{name:"model",rawName:"v-model",value:t.data.otherSettings.additionalHeaderLines,expression:"data.otherSettings.additionalHeaderLines"}],staticClass:"form-control",attrs:{"aria-label":"With textarea",rows:"5",id:"additionalHeaderLines",name:"additionalHeaderLines",disabled:t.data.otherSettings.useGlobalAdditionalHeaderLines},domProps:{value:t.data.otherSettings.additionalHeaderLines},on:{input:function(e){e.target.composing||t.$set(t.data.otherSettings,"additionalHeaderLines",e.target.value)}}})]),s("div",{staticClass:"form-group"},[s("div",{staticClass:"custom-control custom-switch"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.data.otherSettings.useGlobalAdditionalFooterLines,expression:"data.otherSettings.useGlobalAdditionalFooterLines"}],staticClass:"custom-control-input",attrs:{type:"checkbox",id:"useGlobalAdditionalFooterLines",name:"useGlobalAdditionalFooterLines"},domProps:{checked:Array.isArray(t.data.otherSettings.useGlobalAdditionalFooterLines)?t._i(t.data.otherSettings.useGlobalAdditionalFooterLines,null)>-1:t.data.otherSettings.useGlobalAdditionalFooterLines},on:{change:function(e){var s=t.data.otherSettings.useGlobalAdditionalFooterLines,a=e.target,i=!!a.checked;if(Array.isArray(s)){var n=null,o=t._i(s,n);a.checked?o<0&&t.$set(t.data.otherSettings,"useGlobalAdditionalFooterLines",s.concat([n])):o>-1&&t.$set(t.data.otherSettings,"useGlobalAdditionalFooterLines",s.slice(0,o).concat(s.slice(o+1)))}else t.$set(t.data.otherSettings,"useGlobalAdditionalFooterLines",i)}}}),s("label",{staticClass:"custom-control-label",attrs:{for:"useGlobalAdditionalFooterLines"}},[t._v(" "+t._s(t.getSettingsDescription("otherSettings","useGlobalAdditionalFooterLines"))+" ")])])]),s("div",{staticClass:"form-group"},[s("label",{attrs:{for:"additionalFooterLines"}},[t._v(" "+t._s(t.getSettingsDescription("otherSettings","additionalFooterLines"))+" ")]),s("textarea",{directives:[{name:"model",rawName:"v-model",value:t.data.otherSettings.additionalFooterLines,expression:"data.otherSettings.additionalFooterLines"}],staticClass:"form-control",attrs:{"aria-label":"With textarea",rows:"5",id:"additionalFooterLines",name:"additionalFooterLines",disabled:t.data.otherSettings.useGlobalAdditionalFooterLines},domProps:{value:t.data.otherSettings.additionalFooterLines},on:{input:function(e){e.target.composing||t.$set(t.data.otherSettings,"additionalFooterLines",e.target.value)}}})])])])]),s("div",{staticClass:"col-6 offset-6 text-right"},[s("button",{staticClass:"btn btn-primary btn-sm",attrs:{disabled:t.saving},on:{click:function(e){return t.saveDeviceSettings(t.id)}}},[t.saving?s("div",{staticClass:"spinner-grow spinner-grow-sm",staticStyle:{cursor:"help"},attrs:{title:"Получение статуса соединения",role:"status"}},[s("span",{staticClass:"sr-only"},[t._v("Loading...")])]):s("font-awesome-icon",{attrs:{icon:"save"}}),t._v(" Сохранить ")],1)])])])])])])]):null===t.status_code?s("div",{staticClass:"col-12 pt-3"},[t._m(1)]):404===t.status_code?s("div",{staticClass:"col-12 pt-3"},[s("div",{staticClass:"alert alert-danger",attrs:{role:"alert"}},[t._v(" Отсутствует связь с сервером... ")])]):t._e()])},o=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ul",{staticClass:"nav nav-tabs",attrs:{id:"myTab",role:"tablist"}},[s("li",{staticClass:"nav-item"},[s("a",{staticClass:"nav-link active",attrs:{id:"requests-queue-statuses-tab","data-toggle":"tab",href:"#requests-queue-statuses",role:"tab","aria-controls":"requests-queue-statuses","aria-selected":"true"}},[t._v("Очередь заданий")])]),s("li",{staticClass:"nav-item"},[s("a",{staticClass:"nav-link",attrs:{id:"settings-tab","data-toggle":"tab",href:"#settings",role:"tab","aria-controls":"settings","aria-selected":"false"}},[t._v("Настройки устройства")])])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"d-flex justify-content-center"},[s("div",{staticClass:"spinner-border",staticStyle:{width:"5rem",height:"5rem"},attrs:{role:"status"}},[s("span",{staticClass:"sr-only"},[t._v("Загрузка...")])])])}],r=(s("a4d3"),s("e01a"),s("d3b7"),s("ac1f"),s("1276"),s("3dfd")),l=s("4396"),c=s.n(l),d=s("1157"),u=s.n(d),v=(s("b0c0"),{methods:{saveTextareaHeights:function(){for(var t=u()("textarea"),e=0;e<t.length;e++){var s=u()(t[e]);s.outerHeight()>0&&this.$cookie.set(this.$route.name+"_"+s.attr("id")+"_height",s.height())}},setTextareaHeights:function(){for(var t=u()("textarea"),e=0;e<t.length;e++){var s=u()(t[e]),a=this.$cookie.get(this.$route.name+"_"+s.attr("id")+"_height");null!==a&&s.height(a)}}},created:function(){window.addEventListener("beforeunload",this.saveTextareaHeights)},updated:function(){this.setTextareaHeights()}}),g=s("5da1"),p={number:{type:"integer",description:"Количество незавершенных заданий в очереди"},canceled:{type:"integer",description:"Количество отмененных заданий"},ready:{type:"integer",description:"Количество завершенных заданий"},isBlocked:{type:"boolean",description:"Очередь заданий заблокирована"},blockReason:{type:"string",description:"Причина блокировки очереди",enum:{paperError:"Ошибка бумаги",connectionError:"Ошибка связи",fnError:"Ошибка ФН"}},blockedUUID:{type:"string",description:"UUID задания, вызвавшего блокировку очереди"}},m={port:{type:"string",description:"Канал связи с ККТ"},com:{type:"string",description:"Название COM-порта / TTY-устройства"},baudRate:{type:"integer",description:"Скорость COM-порта"},ipAddress:{type:"string",description:"IP-адрес ККТ"},ipPort:{type:"integer",description:"IP-порт ККТ",maximum:65535,minimum:0},mac:{type:"string",description:"MAC-адрес Bluetooth ККТ"},ofdChannel:{type:"string",description:"Канал до ОФД"},accessPassword:{type:"string",description:"Пароль доступа"},userPassword:{type:"string",description:"Пароль пользователя по умолчанию"},usbDevice:{type:"string",description:"Адрес USB-устройства"}},h={useGlobalScriptsSettings:{type:"boolean",description:"Использовать путь к каталогу со скриптами ДТО10 из настроек WEB-сервера"},scriptsPath:{type:"string",description:"Путь к каталогу со скриптами ДТО10"},useGlobalInvertCashDrawerStatusFlag:{type:"boolean",description:"Использовать значение флага инверсии из настроек WEB-сервера"},invertCashDrawerStatus:{type:"boolean",description:"Инвертировать состояние денежного ящика"},useGlobalAdditionalHeaderLines:{type:"boolean",description:"Использовать дополнительные строки заголовка документа из настроек WEB-сервера"},additionalHeaderLines:{type:"text",description:"Дополнительные строки заголовка документа"},useGlobalAdditionalFooterLines:{type:"boolean",description:"Использовать дополнительные строки подвала документа из настроек WEB-сервера"},additionalFooterLines:{type:"text",description:"Дополнительные строки подвала документа"}},f={name:"Device",mixins:[v],data:function(){return{id:"",data:null,saving:!1,original_data:null,com_intermediary:null,status_code:null,requests_queue_status_code:null,requestsQueueStatusData:null,descriptions:{requestsQueueStatus:p,connectionSettings:m,otherSettings:h},os:null}},components:{MaskedInput:c.a},watch:{com_intermediary:function(t){if(this.mapping_com){for(var e=0;e<this.mapping_com.length;e++)if(t===this.mapping_com[e]["description"])return void(this.data.connectionSettings.com=this.mapping_com[e]["key"]);this.data.connectionSettings.com=t}},mapping_com:function(t){if(t)for(var e=0;e<t.length;e++)this.com_intermediary===t[e]["key"]&&(this.com_intermediary=t[e]["description"])},"data.connectionSettings.com":function(t){if(this.mapping_com)for(var e=0;e<this.mapping_com.length;e++)t===this.mapping_com[e]["key"]&&(this.com_intermediary=this.mapping_com[e]["description"])}},methods:{getRequestQueueValueView:function(t,e){if("isBlocked"===t){var s=e?"badge-danger":"badge-success",a=e?"ДА":"НЕТ";return'<span class="badge badge-pill '+s+'">'+a+"</span>"}return""===e?'<span class="badge badge-pill badge-dark">Нет данных</span>':'<span class="badge badge-pill badge-info">'+e+"</span>"},updateParameterValue:function(t,e){for(var s=t.split("_"),a=this.data,i=0,n=s.length;i<n-1;i++)a=a[s[i]];a[s[n-1]]=e},getSettingsDescription:function(t,e){return this.descriptions.hasOwnProperty(t)&&this.descriptions[t].hasOwnProperty(e)?this.descriptions[t][e]["description"]:e},getSettingInput:function(t,e,s){if(this.descriptions.hasOwnProperty(t)&&this.descriptions[t].hasOwnProperty(e)){var a=this.descriptions[t][e];return a["parameterName"]=e,a["settingName"]=t,a["value"]=s,a}return null},getClass:function(){var t="border ";switch(this.requests_queue_status_code){case 200:t+="border-primary";break;case 403:t+="border-danger";break;case 404:t+="border-warning";break;default:t+="border-secondary";break}return t},getText:function(){var t="";switch(this.requests_queue_status_code){case 200:t+="Успешно получено";break;case 403:t+="ККТ не активирована";break;case 404:t+="ККТ по заданному идентификатору не найдена";break;default:t+="Неизвестная ошибка";break}return t},getDevice:function(t){var e=this;r["a"].get("devices/"+t).then((function(t){e.status_code=t.status,e.data=t.data,e.original_data=JSON.parse(JSON.stringify(t.data)),e.com_intermediary=e.data.connectionSettings.com})).catch((function(t){t.response?(e.status_code=t.response.status,e.$emit("newMessage","Получение данных устройства","Не удалось получить данные устройства.</br>"+t.response.data,"get_device_toast_",!0)):(e.status_code=404,e.$emit("newMessage","Получение данных устройства","Не удалось получить данные устройства, отсутствует связь с сервером","get_device_toast_",!0))})).finally((function(){}))},getRequestsQueueStatus:function(t){var e=this;r["a"].get("getRequestsQueueStatus",{params:{deviceID:t}}).then((function(t){e.requests_queue_status_code=t.status,t.data.isBlocked?t.data["blockReason"]=e.descriptions.requestsQueueStatus.blockReason.enum[t.data["blockReason"]]:(delete t.data["blockReason"],delete t.data["blockedUUID"]),e.requestsQueueStatusData=t.data})).catch((function(t){t.response&&(e.requests_queue_status_code=t.response.status,e.requestsQueueStatusData=t.response.data)})).finally((function(){}))},saveDeviceSettings:function(t){var e=this,s="Настройки успешно сохранены",a=u()("form#otherSettings"),i=u()("form#connectionSettings"),n=a[0].checkValidity(),o=i[0].checkValidity();return o?n?(this.saving=!0,i.toggleClass("was-validated",!1),a.toggleClass("was-validated",!1),void r["a"].put("devices/"+t,this.data).then((function(){e.original_data=JSON.parse(JSON.stringify(e.data))})).catch((function(t){s="Не удалось произвести сохранение настроек",t.response?s+="<br>"+t.response.data.error.description:(s+="<br>Отсутствует связь с сервером",e.status_code=404)})).finally((function(){e.saving=!1,e.$emit("newMessage","Сохранение настроек",s,"device_setting_toast_",!0)}))):(u()("#other-setting-tab").click(),void a.toggleClass("was-validated",!0)):(u()("#connection-settings-tab").click(),void i.toggleClass("was-validated",!0))},getPlaceholder:function(t){var e=this.$store.getters.OS,s="";return this.os=e,"com"===t&&(s="windows"===e?"COM1":"/dev/ttyACM0"),s}},computed:{mapping_model:function(){return this.$store.getters.MAPPING["model"]},mapping_ofd_channel:function(){return this.$store.getters.MAPPING["ofdChannel"]},mapping_com:function(){return this.$store.getters.MAPPING["com"]},mapping_baud_rate:function(){return this.$store.getters.MAPPING["baudRate"]},mapping_port:function(){return this.$store.getters.MAPPING["port"]},mapping_usb_device:function(){return this.$store.getters.MAPPING["usbDevice"]},ipAddressClass:function(){return"windows"!==this.os?"form-group col-sm-8 col-md-6 col-lg-3":"form-group col-sm-12 col-md-6 col-lg-7"}},mounted:function(){this.id=this.$route.params.device_id,this.getDevice(this.id),this.getRequestsQueueStatus(this.id)},beforeRouteLeave:function(t,e,s){this.saveTextareaHeights();var a=t.params.hasOwnProperty("need_authorization")&&!0===t.params.need_authorization,i=t.params.hasOwnProperty("server_available")&&!1===t.params.server_available;if(!g(this.data,this.original_data)&&!i&&!a){var n=window.confirm("Есть несохранённые изменения, Вы точно хотите покинуть страницу?");if(!n)return void s(!1)}s()}},_=f,b=s("2877"),S=Object(b["a"])(_,n,o,!1,null,"2f9bec5e",null),C=S.exports,w=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"row"},[200===t.status_code?s("div",{staticClass:"col-12 pt-3"},[s("div",{staticClass:"devices"},[s("div",{staticClass:"row"},[t._m(0),s("div",{staticClass:"col-4 text-right"},[s("button",{staticClass:"btn btn-primary btn-sm",attrs:{id:"show-modal"},on:{click:function(e){t.show_modal=!0}}},[s("font-awesome-icon",{attrs:{icon:"plus"}}),t._v(" Добавить ")],1)])]),s("div",{staticClass:"table-responsive"},[t.devices.length>0?s("table",{staticClass:"table table-hover"},[t._m(1),s("tbody",t._l(t.devices,(function(e,a){return s("DeviceRow",{key:e.id,attrs:{index:a,device:e,poll_timeout:t.default_polling_timeout},on:{"confirm-delete":t.confirmDelete}})})),1)]):s("div",{staticClass:"alert alert-info",attrs:{role:"alert"}},[s("h4",{staticClass:"alert-heading"},[t._v("Отсутствуют...")]),s("p",[t._v("Для отображения списка устройств необходимо для начала их добавить...")]),s("hr"),s("p",{staticClass:"mb-0"},[t._v("Для добавления устройства, нажмите на соответствующую кнопку "),s("button",{staticClass:"btn btn-primary btn-sm",attrs:{id:"show-modal-2"},on:{click:function(e){t.show_modal=!0}}},[s("font-awesome-icon",{attrs:{icon:"plus"}}),t._v(" Добавить ")],1),t._v(' , заполните обязательные поля и в модульном окне нажмите кнопку "Добавить" ')]),t._m(2)])])])]):404===t.status_code?s("div",{staticClass:"col-12 pt-3"},[s("div",{staticClass:"alert alert-danger",attrs:{role:"alert"}},[t._v(" Отсутствует связь с сервером... ")])]):null===t.status_code?s("div",{staticClass:"col-12 pt-3"},[t._m(3)]):t._e(),s("AddDeviceModal",{attrs:{show:t.show_modal},on:{deviceCreated:t.addDevice,modalClosed:t.setShowFalse}}),s("ConfirmModal",{ref:"confirm-modal",on:{result:t.deleteDevice}})],1)},y=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"col-8"},[s("h4",[t._v("Устройства")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("thead",[s("tr",[s("th",{attrs:{scope:"col"}},[t._v("#")]),s("th",{attrs:{scope:"col"}},[t._v("Идентификатор ККТ")]),s("th",{attrs:{scope:"col"}},[t._v("Название ККТ")]),s("th",{attrs:{scope:"col"}},[t._v("Статус соединения")]),s("th",{attrs:{scope:"col"}},[t._v("Работа с ККТ (выкл./вкл.)")]),s("th",{attrs:{scope:"col"}},[t._v("Использовать по умолчанию")]),s("th",{attrs:{scope:"col"}})])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("figure",{staticClass:"figure mt-3"},[a("img",{staticClass:"figure-img img-fluid rounded",attrs:{alt:"Пример модульного окна",src:s("53af")}}),a("figcaption",{staticClass:"figure-caption text-right"},[t._v("Пример модульного окна.")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"d-flex justify-content-center"},[s("div",{staticClass:"spinner-border",staticStyle:{width:"5rem",height:"5rem"},attrs:{role:"status"}},[s("span",{staticClass:"sr-only"},[t._v("Loading...")])])])}],A=(s("a434"),function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"modal",attrs:{id:t.modalId,tabindex:"-1",role:"dialog","aria-hidden":"true","data-backdrop":"static","data-keyboard":"false"}},[s("div",{staticClass:"modal-dialog modal-dialog-centered",attrs:{role:"document"}},[s("div",{staticClass:"modal-content"},[t._m(0),s("div",{staticClass:"modal-body"},[s("form",{staticClass:"needs-validation",attrs:{novalidate:""}},[s("div",{staticClass:"form-row"},[s("div",{staticClass:"col-12 mb-3"},[s("label",{attrs:{for:"deviceId"}},[t._v("Уникальный идентификатор ККТ")]),s("input",{directives:[{name:"model",rawName:"v-model",value:t.device.id,expression:"device.id"}],ref:"device_id",staticClass:"form-control",attrs:{type:"text",id:"deviceId",placeholder:"Идентификатор устройства",pattern:"^[a-zA-Z0-9_-]{1,16}$",value:"Mark",required:""},domProps:{value:t.device.id},on:{input:function(e){e.target.composing||t.$set(t.device,"id",e.target.value)}}}),s("div",{staticClass:"invalid-feedback"},[t._v(" Поле обязательно для заполнения, должно состоять из цифр, букв латинского алфавита любого регистра, нижнего подчеркивания и тире, длина идентификатара от 1 до 16 символов. ")])]),s("div",{staticClass:"col-12 mb-3"},[s("label",{attrs:{for:"deviceName"}},[t._v("Название ККТ")]),s("input",{directives:[{name:"model",rawName:"v-model",value:t.device.name,expression:"device.name"}],staticClass:"form-control",attrs:{type:"text",id:"deviceName",placeholder:"Произвольное название устройства",pattern:"^.{0,128}$"},domProps:{value:t.device.name},on:{input:function(e){e.target.composing||t.$set(t.device,"name",e.target.value)}}}),s("div",{staticClass:"invalid-feedback"},[t._v(" Имя устройства должно быть не более 128 символов ")])])])]),null!==t.errors?s("div",{staticClass:"alert alert-danger",attrs:{role:"alert"}},[t._v(" "+t._s(t.errors)+" ")]):t._e()]),s("div",{staticClass:"modal-footer"},[s("button",{staticClass:"btn btn-primary",attrs:{type:"button"},on:{click:t.addDevice}},[t._v("Добавить")]),s("button",{staticClass:"btn btn-secondary",attrs:{type:"button"},on:{click:t.closeModal}},[t._v("Отмена")])])])])])}),D=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"modal-header"},[s("h5",{staticClass:"modal-title",attrs:{id:"exampleModalLongTitle"}},[t._v("Добавление нового устройства")])])}],k=(s("7db0"),{name:"AddDeviceModal",props:{show:{default:!1}},data:function(){return{device:{id:"",name:""},errors:null}},computed:{modalId:function(){return"showModal_"+this._uid}},watch:{show:function(t){u()("#showModal_"+this._uid).modal(t?"show":"hide"),t&&this.$refs.device_id.focus()}},methods:{addDevice:function(){var t=this,e="Ошибка добавления нового устройства",s=u()("#showModal_"+this._uid).find("form")[0];if(!s.checkValidity())return s.classList.add("was-validated"),!0;r["a"].post("devices",this.device).then((function(e){201===e.status&&(t.errors=null,t.$emit("deviceCreated",e.data))})).catch((function(s){s.response?t.errors=s.response.data.error.description:(e+="<br>Отсутствует связь с сервером",t.statusCode=404,t.$parent.$emit("newMessage","Добавление нового устройства",e,"add_device_toast_",!0))})).finally((function(){null===t.errors&&t.closeModal()}))},closeModal:function(){var t=u()("#showModal_"+this._uid),e=t.find("form")[0];t.modal("hide"),e.classList.remove("was-validated"),this.errors=null,this.device["id"]="",this.device["name"]="",this.$emit("modalClosed")}},beforeDestroy:function(){u()(".modal-backdrop").remove()},mounted:function(){},created:function(){var t=this;window.addEventListener("keydown",(function(e){"Escape"==e.key&&t.closeModal()}))}}),P=k,x=Object(b["a"])(P,A,D,!1,null,"37eb2038",null),$=x.exports,L=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("tr",[s("th",{attrs:{scope:"row"}},[t._v(t._s(t.index+1))]),s("td",{staticClass:"text-nowrap show_pointer",on:{click:function(e){return t.showDevice(t.device.id)}}},[s("button",{staticClass:"btn btn-sm btn-outline-primary btn-block"},[s("font-awesome-icon",{attrs:{icon:"eye"}}),t._v(" "+t._s(t.device.id)+" ")],1)]),s("td",{staticClass:"text-nowrap text-monospace",staticStyle:{cursor:"help"},attrs:{title:t.device.name}},[t._v(t._s(t.truncDeviceName()))]),s("td",{staticClass:"text-nowrap text-center text-monospace",attrs:{title:"Статус соединения"}},[t.device.isActive?null===t.poll.accessibility?s("div",{staticClass:"spinner-grow spinner-grow-sm",staticStyle:{cursor:"help"},attrs:{title:"Получение статуса соединения",role:"status"}},[s("span",{staticClass:"sr-only"},[t._v("Loading...")])]):t.poll.accessibility?s("span",{staticClass:"badge btn-block badge-success"},[t._v("Доступен")]):s("span",{staticClass:"badge btn-block badge-danger",staticStyle:{cursor:"help"},attrs:{title:t.poll.description}},[t._v("Недоступен")]):s("span",{staticClass:"badge btn-block badge-secondary"},[t._v("Неактивен")])]),s("td",{staticClass:"text-nowrap text-center"},[s("div",{staticClass:"form-group"},[s("div",{staticClass:"custom-control custom-switch"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.device.isActive,expression:"device.isActive"}],staticClass:"custom-control-input",attrs:{type:"checkbox",id:"activation-toggler-"+t.device.id,name:"activation-toggler-"+t.device.id,disabled:t.activation_toggler_disabled},domProps:{checked:Array.isArray(t.device.isActive)?t._i(t.device.isActive,null)>-1:t.device.isActive},on:{change:[function(e){var s=t.device.isActive,a=e.target,i=!!a.checked;if(Array.isArray(s)){var n=null,o=t._i(s,n);a.checked?o<0&&t.$set(t.device,"isActive",s.concat([n])):o>-1&&t.$set(t.device,"isActive",s.slice(0,o).concat(s.slice(o+1)))}else t.$set(t.device,"isActive",i)},function(e){return e.stopPropagation(),t.toggleActivation(e)}]}}),s("label",{staticClass:"custom-control-label",attrs:{for:"activation-toggler-"+t.device.id}})])])]),s("td",{staticClass:"text-nowrap text-center"},[s("div",{staticClass:"form-group"},[s("div",{staticClass:"custom-control custom-switch"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.device.isDefault,expression:"device.isDefault"}],staticClass:"custom-control-input",attrs:{type:"checkbox",id:"set-default-"+t.device.id,name:"set-default-"+t.device.id,disabled:t.device.isDefault},domProps:{checked:Array.isArray(t.device.isDefault)?t._i(t.device.isDefault,null)>-1:t.device.isDefault},on:{change:[function(e){var s=t.device.isDefault,a=e.target,i=!!a.checked;if(Array.isArray(s)){var n=null,o=t._i(s,n);a.checked?o<0&&t.$set(t.device,"isDefault",s.concat([n])):o>-1&&t.$set(t.device,"isDefault",s.slice(0,o).concat(s.slice(o+1)))}else t.$set(t.device,"isDefault",i)},function(e){return e.stopPropagation(),t.setAsDefaultDevice(e)}]}}),s("label",{staticClass:"custom-control-label",attrs:{for:"set-default-"+t.device.id}})])])]),s("td",[s("button",{staticClass:"btn btn-danger btn-sm",on:{click:function(e){return e.stopPropagation(),t.confirmDelete(e)}}},[s("font-awesome-icon",{attrs:{icon:"trash-alt"}})],1)])])},O=[],I=(s("a9e3"),s("38cf"),new a["a"]),q={name:"DeviceRow",props:{device:{type:Object,default:[]},index:{type:Number,default:0},poll_timeout:{type:Number,default:6e4}},data:function(){return{event_bus:I,activation_toggler_disabled:!1,poll:{accessibility:null,description:"",timeout_id:null},destroyed:!1}},methods:{truncDeviceName:function(){var t=this.device.name,e=25,s=3,a=t.length;return a>e&&(t=t.substring(0,e-s)+".".repeat(s)),t},startPollingStatus:function(){var t=this,e="?deviceID="+this.device.id;r["a"].post("operations/queryDeviceInfo"+e).then((function(){t.poll.accessibility=!0})).catch((function(e){e.response?(t.poll.accessibility=!1,e.response.data.hasOwnProperty("error")?t.poll.description=e.response.data.error.description:t.poll.description="Ошибка"):t.status_code=404})).finally((function(){t.device.isActive&&!t.destroyed?t.poll.timeout_id=setTimeout(t.startPollingStatus,t.poll_timeout):(t.poll.accessibility=null,t.poll.description="",t.poll.timeout_id=null)}))},confirmDelete:function(){this.$emit("confirm-delete",this.device.id)},setAsDefaultDevice:function(){var t="Устройство с идентификатором #"+this.device.id+" теперь является устройством по умолчанию",e=this;r["a"].post("setDefaultDevice",{id:this.device.id}).then((function(){e.event_bus.$emit("default-changed",e.device.id)})).catch((function(s){device&&(e.device.isDefault=!device.isDefault),t="Произошла ошибка назначения устройства с идентификатором #"+device.id+" устройством по умолчанию",s.response||(t+="<br>Отсутствует связь с сервером"),e.$parent.$emit("newMessage","Назначение устройства по умолчанию",t,"set_device_as_default_toast_",!0)}))},toggleActivation:function(){var t=this,e="Не удалось "+(this.device.isActive?"":"де")+"активировать устройство с идентификатором "+this.device.id,s=this;if(!this.activation_toggler_disabled){this.activation_toggler_disabled=!0;var a="?deviceID="+this.device.id;r["a"].post((this.device.isActive?"activateDevice":"deactivateDevice")+a,{id:this.device.id}).catch((function(a){s.device.isActive=!s.device.isActive,a.response||(e+="<br>Отсутствует связь с сервером"),s.$parent.$emit("newMessage",(t.device.isActive?"А":"Деa")+"ктивация устройства",e,(t.device.isActive?"":"de")+"activation_device_toast_",!0)})).finally((function(){s.activation_toggler_disabled=!1,s.device.isActive&&null===s.poll.timeout_id?t.startPollingStatus():t.poll.timeout_id&&(clearTimeout(t.poll.timeout_id),t.poll.timeout_id=null,t.poll.accessibility=null,t.poll.description="")}))}},showDevice:function(){this.$router.push({path:"devices/".concat(this.device.id)})}},mounted:function(){var t=this;this.event_bus.$on("default-changed",(function(e){t.device.id!==e&&t.device.isDefault&&(t.device.isDefault=!1)})),this.device.isActive&&this.startPollingStatus()},beforeDestroy:function(){this.destroyed=!0,this.poll.timeout_id&&clearTimeout(this.poll.timeout_id)}},F=q,N=Object(b["a"])(F,L,O,!1,null,null,null),G=N.exports,M=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"modal fade",attrs:{id:t.modalId,tabindex:"-1",role:"dialog","aria-hidden":"true"}},[s("div",{staticClass:"modal-dialog",attrs:{role:"document"}},[s("div",{staticClass:"modal-content"},[t._m(0),s("div",{staticClass:"modal-body"},[t._v(" "+t._s(t.message)+" ")]),s("div",{staticClass:"modal-footer"},[s("button",{staticClass:"btn btn-danger",attrs:{type:"button"},on:{click:function(e){return t.emitResult(!0)}}},[t._v(" Удалить ")]),s("button",{staticClass:"btn btn-secondary",attrs:{type:"button"},on:{click:function(e){return t.emitResult(!1)}}},[t._v(" Отмена ")])])])])])},E=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"modal-header"},[s("h5",{staticClass:"modal-title",attrs:{id:"exampleModalLabel"}},[t._v("Подтвердите действие")])])}],R={name:"ConfirmModal",data:function(){return{message:""}},methods:{emitResult:function(t){u()("#showModal_"+this._uid).modal("hide"),this.$emit("result",t)}},computed:{modalId:function(){return"showModal_"+this._uid}}},H=R,Q=Object(b["a"])(H,M,E,!1,null,"85fdf2fe",null),T=Q.exports,j={name:"Devices",data:function(){return{show_modal:!1,block_polls:!1,devices:[],status_code:null,device_to_delete:null,default_polling_timeout:6e4,polls:{}}},components:{AddDeviceModal:$,DeviceRow:G,ConfirmModal:T},watch:{},methods:{confirmDelete:function(t){this.device_to_delete=t,this.$refs["confirm-modal"].message="Вы действительно хотите удалить устройство с идентификатором "+t+"?",u()("#"+this.$refs["confirm-modal"].modalId).modal("show")},getDeviceInstanceById:function(t){for(var e=0;e<this.devices.length;e++)if(this.devices[e].id===t)return this.devices[e];return null},getDevices:function(){var t=this,e="Не удалось получить список устройств";r["a"].get("devices").then((function(e){t.status_code=e.status,t.devices=e.data})).catch((function(s){s.response?(t.status_code=s.response.status,t.data=s.response.data):(e+="<br>Отсутствует связь с сервером",t.status_code=404),t.$emit("newMessage","Список устройств",e,"devices_toast_",!0)}))},addDevice:function(t){if(t){for(var e=0;e<this.devices.length;e++)if(t.id===this.devices[e].id)return void this.$emit("newMessage","Добавление устройства","Устройство с идентификатором #"+t.id+" уже присутствует в списке","add_device_toast_",!0);this.devices.push(t)}},setDefaultDeviceInstance:function(){var t=this;r["a"].get("devices/default").then((function(e){for(var s=e.data.id,a=0;a<t.devices.length;a++)t.devices[a].id===s&&(t.devices[a].isDefault=!0)}))},deleteDeviceInstanceById:function(t){for(var e=0;e<this.devices.length;e++){var s=this.devices[e];if(s.id===t){s.isDefault&&this.devices.length>1&&this.setDefaultDeviceInstance(),this.devices.splice(e,1);break}}},deleteDevice:function(t){var e=this;if(!t)return!1;var s=this.device_to_delete,a="Не удалось удалить устройство";r["a"].delete("devices/"+s).then((function(t){200===t.status&&e.deleteDeviceInstanceById(s)})).catch((function(t){t.response?404===t.response.status&&(a+="<br>ККТ не найдена",e.deleteDeviceInstanceById(s)):a+="<br>Отсутствует связь с сервером",e.$emit("newMessage","Список устройств",a,"delete_device_toast_",!0)}))},setShowFalse:function(){this.show_modal=!1}},created:function(){var t=parseInt(this.$route.query.timeout);isNaN(t)||(this.default_polling_timeout=t),this.getDevices()}},B=j,V=(s("11fa"),Object(b["a"])(B,w,y,!1,null,"d484a782",null)),z=V.exports,J=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"row"},[200===t.status_code||null!==t.settings.globalSettings?s("div",{staticClass:"col-12 pt-3"},[s("div",{staticClass:"settings"},[t._m(0),s("div",{staticClass:"row"},[s("form",{staticClass:"needs-validation col-12",attrs:{id:"settings",novalidate:""}},[s("div",{staticClass:"form-group"},[s("label",{attrs:{for:"scriptsPath"}},[t._v(" "+t._s(t.getSettingsDescription("globalSettings","scriptsPath"))+" ")]),s("input",{directives:[{name:"model",rawName:"v-model",value:t.settings.globalSettings.scriptsPath,expression:"settings.globalSettings.scriptsPath"}],staticClass:"form-control",attrs:{type:"text",id:"scriptsPath",name:"scriptsPath"},domProps:{value:t.settings.globalSettings.scriptsPath},on:{input:function(e){e.target.composing||t.$set(t.settings.globalSettings,"scriptsPath",e.target.value)}}})]),s("div",{staticClass:"form-group"},[s("div",{staticClass:"custom-control custom-switch"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.settings.globalSettings.invertCashDrawerStatus,expression:"settings.globalSettings.invertCashDrawerStatus"}],staticClass:"custom-control-input",attrs:{type:"checkbox",id:"invertCashDrawerStatus",name:"invertCashDrawerStatus"},domProps:{checked:Array.isArray(t.settings.globalSettings.invertCashDrawerStatus)?t._i(t.settings.globalSettings.invertCashDrawerStatus,null)>-1:t.settings.globalSettings.invertCashDrawerStatus},on:{change:function(e){var s=t.settings.globalSettings.invertCashDrawerStatus,a=e.target,i=!!a.checked;if(Array.isArray(s)){var n=null,o=t._i(s,n);a.checked?o<0&&t.$set(t.settings.globalSettings,"invertCashDrawerStatus",s.concat([n])):o>-1&&t.$set(t.settings.globalSettings,"invertCashDrawerStatus",s.slice(0,o).concat(s.slice(o+1)))}else t.$set(t.settings.globalSettings,"invertCashDrawerStatus",i)}}}),s("label",{staticClass:"custom-control-label",attrs:{for:"invertCashDrawerStatus"}},[t._v(" "+t._s(t.getSettingsDescription("globalSettings","invertCashDrawerStatus"))+" ")])])]),s("div",{staticClass:"form-group"},[s("label",{attrs:{for:"additionalHeaderLines"}},[t._v(" "+t._s(t.getSettingsDescription("globalSettings","additionalHeaderLines"))+" ")]),s("textarea",{directives:[{name:"model",rawName:"v-model",value:t.settings.globalSettings.additionalHeaderLines,expression:"settings.globalSettings.additionalHeaderLines"}],ref:"additionalHeaderLines",staticClass:"form-control",attrs:{"aria-label":"textarea",rows:"5",id:"additionalHeaderLines",name:"additionalHeaderLines"},domProps:{value:t.settings.globalSettings.additionalHeaderLines},on:{input:function(e){e.target.composing||t.$set(t.settings.globalSettings,"additionalHeaderLines",e.target.value)}}})]),s("div",{staticClass:"form-group"},[s("label",{attrs:{for:"additionalFooterLines"}},[t._v(" "+t._s(t.getSettingsDescription("globalSettings","additionalFooterLines"))+" ")]),s("textarea",{directives:[{name:"model",rawName:"v-model",value:t.settings.globalSettings.additionalFooterLines,expression:"settings.globalSettings.additionalFooterLines"}],ref:"additionalFooterLines",staticClass:"form-control",attrs:{"aria-label":"textarea",rows:"5",id:"additionalFooterLines",name:"additionalFooterLines"},domProps:{value:t.settings.globalSettings.additionalFooterLines},on:{input:function(e){e.target.composing||t.$set(t.settings.globalSettings,"additionalFooterLines",e.target.value)}}})]),s("div",{staticClass:"form-group"},[s("label",{attrs:{for:"deleteRequestsAfter"}},[t._v(" "+t._s(t.getSettingsDescription("globalSettings","deleteRequestsAfter"))+" ")]),s("div",{staticClass:"input-group"},[s("input",{directives:[{name:"model",rawName:"v-model.number",value:t.settings.globalSettings.deleteRequestsAfter,expression:"settings.globalSettings.deleteRequestsAfter",modifiers:{number:!0}}],staticClass:"form-control",attrs:{id:"deleteRequestsAfter",name:"deleteRequestsAfter",type:"number","aria-label":"deleteRequestsAfter",min:"0",max:"4294967295",required:""},domProps:{value:t.settings.globalSettings.deleteRequestsAfter},on:{input:function(e){e.target.composing||t.$set(t.settings.globalSettings,"deleteRequestsAfter",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}}),t._m(1),s("div",{staticClass:"invalid-feedback"},[t._v(" Количество минут должно быть целым числом от 0 до 4294967295 ")])])]),s("div",{staticClass:"form-group"},[s("div",{staticClass:"custom-control custom-switch"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.settings.globalSettings.blockQueueOnPrintErrors,expression:"settings.globalSettings.blockQueueOnPrintErrors"}],staticClass:"custom-control-input",attrs:{type:"checkbox",id:"blockQueueOnPrintErrors",name:"blockQueueOnPrintErrors"},domProps:{checked:Array.isArray(t.settings.globalSettings.blockQueueOnPrintErrors)?t._i(t.settings.globalSettings.blockQueueOnPrintErrors,null)>-1:t.settings.globalSettings.blockQueueOnPrintErrors},on:{change:function(e){var s=t.settings.globalSettings.blockQueueOnPrintErrors,a=e.target,i=!!a.checked;if(Array.isArray(s)){var n=null,o=t._i(s,n);a.checked?o<0&&t.$set(t.settings.globalSettings,"blockQueueOnPrintErrors",s.concat([n])):o>-1&&t.$set(t.settings.globalSettings,"blockQueueOnPrintErrors",s.slice(0,o).concat(s.slice(o+1)))}else t.$set(t.settings.globalSettings,"blockQueueOnPrintErrors",i)}}}),s("label",{staticClass:"custom-control-label",attrs:{for:"blockQueueOnPrintErrors"}},[t._v(" "+t._s(t.getSettingsDescription("globalSettings","blockQueueOnPrintErrors"))+" ")])])]),s("div",{staticClass:"form-group"},[s("div",{staticClass:"custom-control custom-switch"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.settings.globalSettings.validateRequestsOnAdd,expression:"settings.globalSettings.validateRequestsOnAdd"}],staticClass:"custom-control-input",attrs:{type:"checkbox",id:"validateRequestsOnAdd",name:"validateRequestsOnAdd"},domProps:{checked:Array.isArray(t.settings.globalSettings.validateRequestsOnAdd)?t._i(t.settings.globalSettings.validateRequestsOnAdd,null)>-1:t.settings.globalSettings.validateRequestsOnAdd},on:{change:function(e){var s=t.settings.globalSettings.validateRequestsOnAdd,a=e.target,i=!!a.checked;if(Array.isArray(s)){var n=null,o=t._i(s,n);a.checked?o<0&&t.$set(t.settings.globalSettings,"validateRequestsOnAdd",s.concat([n])):o>-1&&t.$set(t.settings.globalSettings,"validateRequestsOnAdd",s.slice(0,o).concat(s.slice(o+1)))}else t.$set(t.settings.globalSettings,"validateRequestsOnAdd",i)}}}),s("label",{staticClass:"custom-control-label",attrs:{for:"validateRequestsOnAdd"}},[t._v(" "+t._s(t.getSettingsDescription("globalSettings","validateRequestsOnAdd"))+" ")])])])]),s("div",{staticClass:"col-12 text-right mt-3"},[s("button",{staticClass:"btn btn-primary btn-sm",attrs:{disabled:t.saving},on:{click:t.saveSettings}},[t.saving?s("div",{staticClass:"spinner-grow spinner-grow-sm",staticStyle:{cursor:"help"},attrs:{title:"Получение статуса соединения",role:"status"}},[s("span",{staticClass:"sr-only"},[t._v("Loading...")])]):s("font-awesome-icon",{attrs:{icon:"save"}}),t._v(" Сохранить ")],1)])])])]):null===t.status_code?s("div",{staticClass:"col-12 pt-3"},[t._m(2)]):404===t.status_code?s("div",{staticClass:"col-12 pt-3"},[s("div",{staticClass:"alert alert-danger",attrs:{role:"alert"}},[t._v(" Отсутствует связь с сервером... ")])]):t._e()])},U=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"row d-block d-sm-none"},[s("div",{staticClass:"col-12"},[s("h4",[t._v("Настройки web-сервера")])])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"input-group-append"},[s("span",{staticClass:"input-group-text",attrs:{id:"basic-addon2"}},[t._v("минут")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"d-flex justify-content-center"},[s("div",{staticClass:"spinner-border",staticStyle:{width:"5rem",height:"5rem"},attrs:{role:"status"}},[s("span",{staticClass:"sr-only"},[t._v("Загрузка...")])])])}],W=s("5da1"),Y={scriptsPath:{type:"string",description:"Путь к каталогу со скриптами ДТО10"},validateRequestsOnAdd:{type:"boolean",description:"Проверять формат заданий при добавлении в очередь"},invertCashDrawerStatus:{type:"boolean",description:"Инвертировать состояние денежного ящика"},additionalHeaderLines:{type:"text",description:"Дополнительные строки заголовка документа"},additionalFooterLines:{type:"text",description:"Дополнительные строки подвала документа"},deleteRequestsAfter:{type:"boolean",description:"Удалять задания из БД через"},blockQueueOnPrintErrors:{type:"boolean",description:"Блокировать очередь заданий при окончании бумаги"}},Z={name:"settings",mixins:[v],data:function(){return{status_code:null,saving:!1,driver_version:"",server_version:"",settings:{globalSettings:null},original_data:{globalSettings:null},descriptions:{globalSettings:Y}}},methods:{emitNewMessage:function(){this.$emit("newMessage","Сохранение настроек","Настройки сохранены","setting_toast_",!0)},getSettings:function(){var t=this,e="Не удалось получить настройки";r["a"].get("settings").then((function(e){t.status_code=e.status,t.settings.globalSettings=e.data,t.original_data.globalSettings=JSON.parse(JSON.stringify(e.data))})).catch((function(s){s.response?t.status_code=s.response.status:(e+="<br>Отсутствует связь с сервером",t.status_code=404),t.$emit("newMessage","Получение настроек",e,"setting_toast_",!0)})).finally((function(){}))},saveSettings:function(){var t=this,e="Настройки успешно сохранены",s=u()("form#settings"),a=s[0].checkValidity();if(!a)return u()("#connection-settings-tab").click(),void s.toggleClass("was-validated",!0);this.saving=!0,s.toggleClass("was-validated",!1),r["a"].put("settings",this.settings.globalSettings).then((function(){t.original_data=JSON.parse(JSON.stringify(t.settings))})).catch((function(s){e="Не удалось произвести сохранение настроек",s.response?t.status_code=s.response.status:(e+="<br>Отсутствует связь с сервером",t.status_code=404)})).finally((function(){t.saving=!1,t.$emit("newMessage","Сохранение настроек",e,"setting_toast_",!0)}))},updateParameterValue:function(t,e){for(var s=t.split("_"),a=this.settings,i=0,n=s.length;i<n-1;i++)a=a[s[i]];a[s[n-1]]=e},getSettingsDescription:function(t,e){return this.descriptions.hasOwnProperty(t)&&this.descriptions[t].hasOwnProperty(e)?this.descriptions[t][e]["description"]:e},getSettingInput:function(t,e,s){if(this.descriptions.hasOwnProperty(t)&&this.descriptions[t].hasOwnProperty(e)){var a=this.descriptions[t][e];return a["parameterName"]=e,a["settingName"]=t,a["value"]=s,a}return null}},mounted:function(){this.getSettings()},beforeRouteLeave:function(t,e,s){this.saveTextareaHeights();var a=t.params.hasOwnProperty("need_authorization")&&!0===t.params.need_authorization,i=t.params.hasOwnProperty("server_available")&&!1===t.params.server_available;if(!W(this.settings,this.original_data)&&!i&&!a){var n=window.confirm("Есть несохранённые изменения, Вы точно хотите покинуть страницу?");if(!n)return void s(!1)}s()}},K=Z,X=Object(b["a"])(K,J,U,!1,null,null,null),tt=X.exports,et=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"row"},[s("form",{ref:"authorizationForm",staticClass:"col-12 col-md-6 col-lg-4 offset-md-3 offset-lg-4 form-signin pt-3"},[s("h1",{staticClass:"h3 mb-3 font-weight-normal text-truncate"},[t._v("Авторизация")]),s("label",{staticClass:"sr-only",attrs:{for:"user_name"}},[t._v("Имя пользователя")]),s("input",{directives:[{name:"model",rawName:"v-model",value:t.user_name,expression:"user_name"}],ref:"userName",staticClass:"form-control mt-2",attrs:{type:"text",id:"user_name",placeholder:"Имя пользователя",required:"",autofocus:""},domProps:{value:t.user_name},on:{input:function(e){e.target.composing||(t.user_name=e.target.value)}}}),s("label",{staticClass:"sr-only",attrs:{for:"user_password"}},[t._v("Пароль")]),s("input",{directives:[{name:"model",rawName:"v-model",value:t.user_password,expression:"user_password"}],ref:"userPassword",staticClass:"form-control mb-3 mt-2",attrs:{type:"password",id:"user_password",placeholder:"Пароль",required:""},domProps:{value:t.user_password},on:{input:function(e){e.target.composing||(t.user_password=e.target.value)}}}),t.fails_count>1?s("div",{staticClass:"alert alert-danger"},[t._v("Неверно введены имя пользователя/пароль")]):t._e(),s("button",{staticClass:"btn btn-lg btn-primary btn-block",attrs:{type:"button"},on:{click:t.checkAuthorization}},[t._v("Войти")])])])},st=[],at={name:"Authorization",data:function(){return{user_name:"",user_password:"",remember_me:!1,fails_count:0}},methods:{checkAuthorization:function(){var t=this.$refs.authorizationForm;if(t.checkValidity()){var e=this.$route.params.target_name;e!==this.$route.path&&e||(e="devices"),u()(t).toggleClass("was-validated",!1),sessionStorage.setItem("user_name",this.user_name),sessionStorage.setItem("user_password",this.user_password),sessionStorage.setItem("access",!0),this.$router.push(e)}else u()(t).toggleClass("was-validated",!0)}},created:function(){var t=JSON.parse(sessionStorage.getItem("access")),e=sessionStorage.getItem("fails_count");null===e?sessionStorage.setItem("fails_count",this.fails_count):this.fails_count=parseInt(e),(t||null===t)&&this.$router.push("devices")},mounted:function(){this.user_name=sessionStorage.getItem("user_name")||"",this.user_password=sessionStorage.getItem("user_password")||""}},it=at,nt=Object(b["a"])(it,et,st,!1,null,null,null),ot=nt.exports,rt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"row"},[s("div",{staticClass:"col mt-3 mb-3"},[s("div",{staticClass:"alert alert-danger",attrs:{role:"alert"}},[s("h4",{staticClass:"alert-heading"},[t._v("Сервер перестал отвечать на запросы.")]),t._m(0),s("hr"),t._m(1),s("hr"),s("p",[s("span",{staticClass:"badge badge-danger text-monospace"},[t._v(t._s(t.sprites[t.current_frame]))]),t._v(" Сделано проверок доступности сервера "+t._s(t.retry_count))])])])])},lt=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[t._v("Проверьте работу сервера и вернитесь к данной странице."),s("br"),t._v("Как только сервер вернет ответ, произойдёт возврат к предыдущей странице.")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"d-flex justify-content-center"},[s("div",{staticClass:"spinner-border",staticStyle:{width:"5rem",height:"5rem"},attrs:{role:"status"}},[s("span",{staticClass:"sr-only"},[t._v("Loading...")])])])}],ct={name:"NotAvailable",data:function(){return{sprites:["-","\\","|","/"],current_frame:0,retry_count:0,destroyed:!1}},methods:{checkServer:function(){var t=this,e=this;r["a"].get("serverInfo").then((function(e){var s=t.$route.params.target_name;s!==t.$route.path&&s||(s="devices"),t.$emit("update-store"),t.$router.push(s)})).catch((function(){e.destroyed||setTimeout(e.checkServer,3e3)})).finally((function(){e.retry_count+=1}))},showLoading:function(){this.current_frame+=1,this.current_frame>=this.sprites.length&&(this.current_frame=0)}},beforeDestroy:function(){this.destroyed=!0},mounted:function(){this.checkServer(),setInterval(this.showLoading,200)}},dt=ct,ut=Object(b["a"])(dt,rt,lt,!1,null,null,null),vt=ut.exports;a["a"].use(i["a"]);var gt=[{path:"*",redirect:"/devices"},{path:"/devices",name:"devices",component:z},{path:"/devices/:device_id",name:"device",component:C},{path:"/settings",name:"settings",component:tt},{path:"/authorization",name:"authorization",component:ot},{path:"/notavailable",name:"notavailable",component:vt}],pt=new i["a"]({mode:"hash",linkActiveClass:"active",linkExactActiveClass:"active",routes:gt});e["a"]=pt}});
//# sourceMappingURL=app.d2509789.js.map